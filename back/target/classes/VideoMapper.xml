<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper
	namespace = "com.my.spring.mapper.VideoMapper">
	<select id="getVideoIdsByGame" parameterType="String" resultType="String">
		select a.id from video a, videoGame b where a.id = b.id and b.game = #{game}
	</select>
	<select id="getDescriptionByVideoId" parameterType="String" resultType="String">
		select description from video where id = #{id}
	</select>
	<select id="getVideoIdsForStatisticsByGame" parameterType="String" resultType="String">
		select a.id from Video a, videoGame b 
		where a.id = b.id and b.game = #{game} and 
		a.id not in (select id from VideoStatistics where infoDate = TO_DATE(SYSDATE, 'YY/MM/DD'))
	</select>
	<select id="getVideoIdsForCommentByGame" parameterType="String" resultType="String">
		select a.id from Video a, videoGame b 
		where a.id = b.id and b.game = #{game} and 
		a.id not in (select videoid id from comments group by videoid)
	</select>
	<select id="getVideoInfo" resultType="com.my.spring.domain.VideoDto">
		select * from video
	</select>
	<select id="getVideoInfoById" parameterType="java.util.List" resultType="com.my.spring.domain.VideoDto">
		select * from video where id in
		<foreach collection="list" item = "item" index = "index" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</select>
	<select id="getVideoTagByVideoId" parameterType="String" resultType="com.my.spring.domain.TagDto">
		select * from Tag where id = #{id}
	</select>
	<insert id="setVideoInfo" parameterType="com.my.spring.domain.VideoDto">
		insert into Video (id, title, thumbnail, description, publisheddate)
		values (#{item.id}, #{item.title}, #{item.thumbnail}, #{item.description}, #{item.publishedDate})
	</insert>
	<insert id="setChain" parameterType="com.my.spring.domain.ChainDto">
		insert into videoGame (id, game)
		values (#{item.id}, #{item.game})
	</insert>
	<insert id="setVideoStatistics" parameterType="com.my.spring.domain.VideoStatDto">
		insert into VideoStatistics (id, infodate, likecount, dislikecount, viewcount, favoritecount, commentcount)
		values (#{item.id}, #{item.infoDate}, #{item.likeCount}, 
		#{item.dislikeCount}, #{item.viewCount}, #{item.favoriteCount}, #{item.commentCount})
	</insert>
	<insert id="setVideoTag" parameterType="com.my.spring.domain.TagDto">
		insert into tag (id, tag) values (#{item.id}, #{item.tag})
	</insert>
	<select id="checkVideoInfo" parameterType="String" resultType="Int">
		select count(*) from Video where id = #{id}
	</select>
	<select id="checkVideoStatistics" parameterType="com.my.spring.domain.VideoStatDto" resultType="Int">
		select count(*) from Videostatistics where id = #{item.id} and infodate = #{item.infoDate}
	</select>
	<select id="checkChain" parameterType="com.my.spring.domain.ChainDto" resultType="Int">
		select count(*) from videoGame where id = #{item.id} and game = #{item.game}
	</select>
	<delete id="filterTagWord">
		delete from tagword
		where length(word) = lengthb(word)
	</delete>
	<delete id="filterVideoWord">
		delete from videoword
		where length(word) = lengthb(word)
	</delete>
	
	<select id="getVideoIdsInComplete" resultType="String">
		select id from video where id not in (
		select id from idComplete where type = 'video')
	</select>
</mapper>