<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper
	namespace = "com.my.spring.mapper.ChannelMapper">
	<select id="getChannelIdsByCtgr" parameterType="String" resultType="String">
		select a.id from channel a, chainchannel b where a.id = b.id and b.ctgr = #{ctgr}
	</select>
	<select id="getChannelIdsForStatisticsByTopic" parameterType="String" resultType="String">
		select a.id from channel a, channelTopic b 
		where a.id = b.id and b.topic = #{topic} and 
		a.id not in (select id from channelStatistics where infoDate = TO_DATE(SYSDATE, 'YY/MM/DD'))
	</select>
	<insert id="setChannelInfo" parameterType="com.my.spring.domain.ChannelDto">
		insert into channel (id, title, thumbnail, description, publisheddate)
		values (#{item.id}, #{item.title}, #{item.thumbnail}, #{item.description}, #{item.publishedDate})
	</insert>
	<insert id="setChain" parameterType="com.my.spring.domain.ChainDto">
		insert into channelTopic (id, topic)
		values (#{item.id}, #{item.topic})
	</insert>
	<insert id="setChannelStatistics" parameterType="com.my.spring.domain.ChannelStatDto">
		insert into channelStatistics (id, infodate, videocount, viewcount, subscount)
		values (#{item.id}, #{item.infoDate}, #{item.videoCount}, #{item.viewCount}, #{item.subsCount})
	</insert>
	<select id="checkChannelInfo" parameterType="String" resultType="Int">
		select count(*) from channel where id = #{id}
	</select>
	<select id="checkChannelStatistics" parameterType="com.my.spring.domain.ChannelStatDto" resultType="Int">
		select count(*) from channelstatistics where id = #{item.id} and infodate = #{item.infoDate}
	</select>
	<select id="checkChain" parameterType="com.my.spring.domain.ChainDto" resultType="Int">
		select count(*) from channelTopic where topic = #{item.topic} and id = #{item.id}
	</select>
</mapper>